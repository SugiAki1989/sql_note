## :memo: Overview

`count(distinct col) over ()`のようにウインドウ関数と`distinct`を組み合わせて計算したい場合の方法をまとめておく。他にもやり方はたくさんあると思うが、ここでは自己結合する方法を利用する。

## :floppy_disk: Database

PostgreSQL

## :bookmark: Tag

`count(distinct)`, `distinct`, `data analysis`

## :pencil2: Example

例えば、DAUMAU のような指標を計算したい場合がある。DAUMAU の計算方法も色々あるが、ここでの MAU の計算方法は当該日を含む 30 日前までの間でのユーザーのユニーク数を計算したものを利用するもの。この場合、指定した期間をさかのぼって、そのウインドウ内のユーザーのユニークな数を計算する必要があり、これをローリングしながら計算させる必要が出てくる。単純に月ごとのユニーク数を利用するケースもあるが、この場合、翌月にならないと、先月の計算ができない。途中までのユーザー数を利用する方法もあるかもしれないが、過去の値が変わるのも違和感がある。

計算のアイデアは簡単で、自分に対して、過去の日付のレコードを紐付ける。ここでは、7 日分を紐付けることにする。このようなケースでは自己結合で不等号`join`すればよい。

```sql
with log1 as (
select createdat, 'x001' as user_id
from generate_series('2022-08-01 00:00:00'::timestamp with time zone,
					 '2022-09-30 00:00:00'::timestamp with time zone,
					 '1 day') as createdat
)
select
    t1.createdat as t1_createdat_x,
    t1.user_id as t1_user_id,
    t2.createdat as t2_createdat_y,
    t2.user_id as t2_user_id
from
    log1 as t1
left join
    log1 as t2
on
    t2.createdat between t1.createdat - interval '7 days' and t1.createdat
;

     t1_createdat_x     | t1_user_id |     t2_createdat_y     | t2_user_id
------------------------+------------+------------------------+------------
 2022-08-01 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-02 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
 2022-08-02 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-03 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
 2022-08-03 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
 2022-08-03 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-04 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
 2022-08-04 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
 2022-08-04 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
 2022-08-04 00:00:00+09 | x001       | 2022-08-04 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-05 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
 2022-08-05 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
 2022-08-05 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
 2022-08-05 00:00:00+09 | x001       | 2022-08-04 00:00:00+09 | x001
 2022-08-05 00:00:00+09 | x001       | 2022-08-05 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-06 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
 2022-08-06 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
 2022-08-06 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
 2022-08-06 00:00:00+09 | x001       | 2022-08-04 00:00:00+09 | x001
 2022-08-06 00:00:00+09 | x001       | 2022-08-05 00:00:00+09 | x001
 2022-08-06 00:00:00+09 | x001       | 2022-08-06 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-07 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
 2022-08-07 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
 2022-08-07 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
 2022-08-07 00:00:00+09 | x001       | 2022-08-04 00:00:00+09 | x001
 2022-08-07 00:00:00+09 | x001       | 2022-08-05 00:00:00+09 | x001
 2022-08-07 00:00:00+09 | x001       | 2022-08-06 00:00:00+09 | x001
 2022-08-07 00:00:00+09 | x001       | 2022-08-07 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-08 00:00:00+09 | x001       | 2022-08-01 00:00:00+09 | x001
 2022-08-08 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
 2022-08-08 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
 2022-08-08 00:00:00+09 | x001       | 2022-08-04 00:00:00+09 | x001
 2022-08-08 00:00:00+09 | x001       | 2022-08-05 00:00:00+09 | x001
 2022-08-08 00:00:00+09 | x001       | 2022-08-06 00:00:00+09 | x001
 2022-08-08 00:00:00+09 | x001       | 2022-08-07 00:00:00+09 | x001
 2022-08-08 00:00:00+09 | x001       | 2022-08-08 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-09 00:00:00+09 | x001       | 2022-08-02 00:00:00+09 | x001
 2022-08-09 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
 2022-08-09 00:00:00+09 | x001       | 2022-08-04 00:00:00+09 | x001
 2022-08-09 00:00:00+09 | x001       | 2022-08-05 00:00:00+09 | x001
 2022-08-09 00:00:00+09 | x001       | 2022-08-06 00:00:00+09 | x001
 2022-08-09 00:00:00+09 | x001       | 2022-08-07 00:00:00+09 | x001
 2022-08-09 00:00:00+09 | x001       | 2022-08-08 00:00:00+09 | x001
 2022-08-09 00:00:00+09 | x001       | 2022-08-09 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-08-10 00:00:00+09 | x001       | 2022-08-03 00:00:00+09 | x001
 2022-08-10 00:00:00+09 | x001       | 2022-08-04 00:00:00+09 | x001
 2022-08-10 00:00:00+09 | x001       | 2022-08-05 00:00:00+09 | x001
 2022-08-10 00:00:00+09 | x001       | 2022-08-06 00:00:00+09 | x001
 2022-08-10 00:00:00+09 | x001       | 2022-08-07 00:00:00+09 | x001
 2022-08-10 00:00:00+09 | x001       | 2022-08-08 00:00:00+09 | x001
 2022-08-10 00:00:00+09 | x001       | 2022-08-09 00:00:00+09 | x001
 2022-08-10 00:00:00+09 | x001       | 2022-08-10 00:00:00+09 | x001
 (snip)
 2022-09-29 00:00:00+09 | x001       | 2022-09-22 00:00:00+09 | x001
 2022-09-29 00:00:00+09 | x001       | 2022-09-23 00:00:00+09 | x001
 2022-09-29 00:00:00+09 | x001       | 2022-09-24 00:00:00+09 | x001
 2022-09-29 00:00:00+09 | x001       | 2022-09-25 00:00:00+09 | x001
 2022-09-29 00:00:00+09 | x001       | 2022-09-26 00:00:00+09 | x001
 2022-09-29 00:00:00+09 | x001       | 2022-09-27 00:00:00+09 | x001
 2022-09-29 00:00:00+09 | x001       | 2022-09-28 00:00:00+09 | x001
 2022-09-29 00:00:00+09 | x001       | 2022-09-29 00:00:00+09 | x001
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-09-30 00:00:00+09 | x001       | 2022-09-23 00:00:00+09 | x001
 2022-09-30 00:00:00+09 | x001       | 2022-09-24 00:00:00+09 | x001
 2022-09-30 00:00:00+09 | x001       | 2022-09-25 00:00:00+09 | x001
 2022-09-30 00:00:00+09 | x001       | 2022-09-26 00:00:00+09 | x001
 2022-09-30 00:00:00+09 | x001       | 2022-09-27 00:00:00+09 | x001
 2022-09-30 00:00:00+09 | x001       | 2022-09-28 00:00:00+09 | x001
 2022-09-30 00:00:00+09 | x001       | 2022-09-29 00:00:00+09 | x001
 2022-09-30 00:00:00+09 | x001       | 2022-09-30 00:00:00+09 | x001
(460 rows)
```

これを見てもわかるが、各日付のレコードが 1 行しかない場合、そこまでサイズが大きくならないが、各日に何人ものユーザーがいると、サイズが大きくなり、パフォーマンスが良くないことが予想できる。ここでは BigQuery の公開データセットのスタックオーバーフローのデータの一部を利用して、ユーザー 2 名の 16 行のレコードで先程の SQL を実行してみる。

```sql
select count(1) from questions;
 count
-------
 71453
(1 row)

select
    owner_user_id as user_id,
    creation_date::date as createdat
from
    questions
where owner_user_id in ('17839680', '18141371');

 user_id  | createdat
----------+------------
 17839680 | 2022-01-05
 17839680 | 2022-01-14
 17839680 | 2022-02-10
 17839680 | 2022-02-15
 17839680 | 2022-02-23
 17839680 | 2022-02-25
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 18141371 | 2022-02-07
 18141371 | 2022-02-20
 18141371 | 2022-02-13
 18141371 | 2022-02-16
 18141371 | 2022-02-17
 18141371 | 2022-02-21
 18141371 | 2022-02-23
 18141371 | 2022-02-24
 18141371 | 2022-03-02
 18141371 | 2022-03-03
(16 rows)
```

ほしい形式にデータを処理できているが、63 行に膨れていることがわかる。

```sql
with tmp as (
select
    owner_user_id as user_id,
    creation_date::date as createdat
from
    questions
where owner_user_id in ('17839680', '18141371')
group by owner_user_id, creation_date::date
order by owner_user_id asc, creation_date::date asc
)
select
    t1.createdat as t1_createdat,
    t2.createdat as t2_createdat,
    t1.user_id as t1_user_id,
    t2.user_id as t2_user_id
from
    tmp as t1
left join
    tmp as t2
on
    t2.createdat between (t1.createdat - interval '7 days') and t1.createdat
order by
    t1.createdat asc, t2.createdat asc, t1.user_id, t2.user_id
;
 t1_createdat | t2_createdat | t1_user_id | t2_user_id
--------------+--------------+------------+------------
 2022-01-05   | 2022-01-05   | 17839680   | 17839680
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-01-14   | 2022-01-14   | 17839680   | 17839680
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-07   | 2022-02-07   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-10   | 2022-02-07   | 17839680   | 18141371
 2022-02-10   | 2022-02-10   | 17839680   | 17839680
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-13   | 2022-02-07   | 18141371   | 18141371
 2022-02-13   | 2022-02-10   | 18141371   | 17839680
 2022-02-13   | 2022-02-13   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-15   | 2022-02-10   | 17839680   | 17839680
 2022-02-15   | 2022-02-13   | 17839680   | 18141371
 2022-02-15   | 2022-02-15   | 17839680   | 17839680
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-16   | 2022-02-10   | 18141371   | 17839680
 2022-02-16   | 2022-02-13   | 18141371   | 18141371
 2022-02-16   | 2022-02-15   | 18141371   | 17839680
 2022-02-16   | 2022-02-16   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-17   | 2022-02-10   | 18141371   | 17839680
 2022-02-17   | 2022-02-13   | 18141371   | 18141371
 2022-02-17   | 2022-02-15   | 18141371   | 17839680
 2022-02-17   | 2022-02-16   | 18141371   | 18141371
 2022-02-17   | 2022-02-17   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-20   | 2022-02-13   | 18141371   | 18141371
 2022-02-20   | 2022-02-15   | 18141371   | 17839680
 2022-02-20   | 2022-02-16   | 18141371   | 18141371
 2022-02-20   | 2022-02-17   | 18141371   | 18141371
 2022-02-20   | 2022-02-20   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-21   | 2022-02-15   | 18141371   | 17839680
 2022-02-21   | 2022-02-16   | 18141371   | 18141371
 2022-02-21   | 2022-02-17   | 18141371   | 18141371
 2022-02-21   | 2022-02-20   | 18141371   | 18141371
 2022-02-21   | 2022-02-21   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-23   | 2022-02-16   | 17839680   | 18141371
 2022-02-23   | 2022-02-16   | 18141371   | 18141371
 2022-02-23   | 2022-02-17   | 17839680   | 18141371
 2022-02-23   | 2022-02-17   | 18141371   | 18141371
 2022-02-23   | 2022-02-20   | 17839680   | 18141371
 2022-02-23   | 2022-02-20   | 18141371   | 18141371
 2022-02-23   | 2022-02-21   | 17839680   | 18141371
 2022-02-23   | 2022-02-21   | 18141371   | 18141371
 2022-02-23   | 2022-02-23   | 17839680   | 17839680
 2022-02-23   | 2022-02-23   | 17839680   | 18141371
 2022-02-23   | 2022-02-23   | 18141371   | 17839680
 2022-02-23   | 2022-02-23   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-24   | 2022-02-17   | 18141371   | 18141371
 2022-02-24   | 2022-02-20   | 18141371   | 18141371
 2022-02-24   | 2022-02-21   | 18141371   | 18141371
 2022-02-24   | 2022-02-23   | 18141371   | 17839680
 2022-02-24   | 2022-02-23   | 18141371   | 18141371
 2022-02-24   | 2022-02-24   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-02-25   | 2022-02-20   | 17839680   | 18141371
 2022-02-25   | 2022-02-21   | 17839680   | 18141371
 2022-02-25   | 2022-02-23   | 17839680   | 17839680
 2022-02-25   | 2022-02-23   | 17839680   | 18141371
 2022-02-25   | 2022-02-24   | 17839680   | 18141371
 2022-02-25   | 2022-02-25   | 17839680   | 17839680
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-03-02   | 2022-02-23   | 18141371   | 17839680
 2022-03-02   | 2022-02-23   | 18141371   | 18141371
 2022-03-02   | 2022-02-24   | 18141371   | 18141371
 2022-03-02   | 2022-02-25   | 18141371   | 17839680
 2022-03-02   | 2022-03-02   | 18141371   | 18141371
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 2022-03-03   | 2022-02-24   | 18141371   | 18141371
 2022-03-03   | 2022-02-25   | 18141371   | 17839680
 2022-03-03   | 2022-03-02   | 18141371   | 18141371
 2022-03-03   | 2022-03-03   | 18141371   | 18141371
(63 rows)
```

何のパフォーマンスチューニングもせずに行うと数時間かかっても終わらないので、非常によろしくない。

```sql
-- create index on public.questions (date(creation_date));
with tmp as (
select owner_user_id as user_id, creation_date::date as createdat
from questions
group by owner_user_id, creation_date::date
)
select
    t1.createdat,
    count(distinct t2.user_id) as mau7days
from
    tmp as t1
left join
    tmp as t2
on
    t2.createdat between (t1.createdat - interval '7 days') and t1.createdat
group by
    t1.createdat
order by
    t1.createdat asc
;

```

BigQuery では 14 秒 で結果が返ってくる。ちなみに課金バイト数は 598 MB なので、テラバイト換算で 5.702972412109375E-4、つまり、 0.0005702972412109375 なので、1TB ごとに 6 ドルとすると、ほとんど無料。

```sql
WITH
  tmp AS (
  SELECT
    q.owner_user_id AS user_id,
    DATE(q.creation_date) AS createdat
  FROM
    `bigquery-public-data.stackoverflow.posts_questions` AS q
  INNER JOIN
    `bigquery-public-data.stackoverflow.users` AS u
  ON
    q.owner_user_id = u.id
    AND EXTRACT(YEAR FROM u.creation_date) = 2022
  GROUP BY
    owner_user_id,
    DATE(q.creation_date) )
SELECT
  t1.createdat,
  COUNT(DISTINCT t2.user_id) AS mau7days
FROM
  tmp AS t1
LEFT JOIN
  tmp AS t2
ON
  t2.createdat BETWEEN DATE_SUB(t1.createdat, INTERVAL 7 day)
  AND t1.createdat
GROUP BY
  t1.createdat
ORDER BY
  t1.createdat ASC ;
```

| createdat  | mau7days |
| :--------: | :------: |
| 2022-01-01 |  306 ★   |
| 2022-01-02 |  694 ★   |
| 2022-01-03 |   1272   |
| 2022-01-04 |   1978   |
| 2022-01-05 |   2750   |
| 2022-01-06 |   3472   |
| 2022-01-07 |   4145   |
| 2022-01-08 |   4622   |
| 2022-01-09 |   4834   |
| 2022-01-10 |   5182   |
| 2022-01-11 |   5414   |
| 2022-01-12 |   5596   |
| 2022-01-13 |   5625   |
| 2022-01-14 |   5642   |
| 2022-01-15 |  5467 ★  |
| 2022-01-16 |   5490   |
| 2022-01-17 |   5715   |
| 2022-01-18 |   5817   |
| 2022-01-19 |   6011   |
| 2022-01-20 |   6114   |
| 2022-01-21 |   6184   |
| 2022-01-22 |   6081   |
| 2022-01-23 |   6145   |
| 2022-01-24 |   6566   |
| 2022-01-25 |   6827   |
| 2022-01-26 |   6908   |
| 2022-01-27 |   7025   |
| 2022-01-28 |   6975   |
| 2022-01-29 |   6776   |
| 2022-01-30 |   6826   |
| 2022-01-31 |   7143   |
| 2022-02-01 |   7235   |
| 2022-02-02 |   7260   |
| 2022-02-03 |   7535   |
| 2022-02-04 |   7610   |
| 2022-02-05 |  7428 ★  |
| 2022-02-06 |   7563   |
| 2022-02-07 |   8002   |
| 2022-02-08 |   8292   |
| 2022-02-09 |   8567   |
| 2022-02-10 |   8821   |
| 2022-02-11 |   8807   |
| 2022-02-12 |   8431   |
| 2022-02-13 |   8453   |
| 2022-02-14 |   8789   |
| 2022-02-15 |   8906   |
| 2022-02-16 |   9034   |
| 2022-02-17 |   9165   |
| 2022-02-18 |   9168   |
| 2022-02-19 |   8866   |
| 2022-02-20 |   8942   |
| 2022-02-21 |   9473   |
| 2022-02-22 |   9693   |
| 2022-02-23 |   9883   |
| 2022-02-24 |   9896   |
| 2022-02-25 |   9865   |
| 2022-02-26 |   9576   |
| 2022-02-27 |   9652   |
| 2022-02-28 |  10204   |
| 2022-03-01 |  10320   |
| 2022-03-02 |  10534   |
| 2022-03-03 |  10666   |
| 2022-03-04 |  10785   |
| 2022-03-05 |  10462   |
| 2022-03-06 |  9731 ★  |

ウインドウ関数と`distinct`を組み合わせて計算したい場合、マシンパワーが借りれないのであれば、パフォーマンスチューニングするか、他の方法で実現するかを考える必要がありそう。

上記の結果と PostgreSQL の結果が一致しているか、検証(★)しておく。

```sql
with tmp as (
select owner_user_id as user_id, creation_date::date as createdat
from questions
group by owner_user_id, creation_date::date
)
select count(distinct user_id)
from tmp
where createdat between ('2022-01-01'::date - interval '7 days') and '2022-01-01'::date;

 count
-------
   306
(1 row)

with tmp as (
select owner_user_id as user_id, creation_date::date as createdat
from questions
group by owner_user_id, creation_date::date
)
select count(distinct user_id)
from tmp
where createdat between ('2022-01-02'::date - interval '7 days') and '2022-01-02'::date;

 count
-------
   694
(1 row)

with tmp as (
select owner_user_id as user_id, creation_date::date as createdat
from questions
group by owner_user_id, creation_date::date
)
select count(distinct user_id)
from tmp
where createdat between ('2022-01-15'::date - interval '7 days') and '2022-01-15'::date;

 count
-------
  5467
(1 row)

with tmp as (
select owner_user_id as user_id, creation_date::date as createdat
from questions
group by owner_user_id, creation_date::date
)
select count(distinct user_id)
from tmp
where createdat between ('2022-02-05'::date - interval '7 days') and '2022-02-05'::date;

 count
-------
  7428
(1 row)

with tmp as (
select owner_user_id as user_id, creation_date::date as createdat
from questions
group by owner_user_id, creation_date::date
)
select count(distinct user_id)
from tmp
where createdat between ('2022-03-06'::date - interval '7 days') and '2022-03-06'::date;
 count
-------
  9731
(1 row)

```

## :closed_book: Reference

None
